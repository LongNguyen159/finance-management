<div class="my-4 py-4">
    <form [formGroup]="form">
        <div class="flex flex-row gap-2 items-center">
            <mat-form-field>
                <mat-label>Time frame</mat-label>
                <mat-select [value]="calculationBasis" (valueChange)="onCalculationBasisChange($event)">
                    <mat-option value="monthly">1 Month</mat-option>
                    <mat-option value="yearly">1 Year</mat-option>
                </mat-select>
            </mat-form-field>
    
            <mat-form-field appearance="fill">
              <mat-label>Average Income</mat-label>
              <input matInput type="number" formControlName="averageIncome" />
              <span matTextPrefix>{{ currencyService.getCurrencySymbol(currencyService.getSelectedCurrency()) }}&nbsp;</span>
            </mat-form-field>
    
            <mat-form-field appearance="fill">
              <mat-label>Target Savings</mat-label>
              <input matInput type="number" formControlName="targetSavings" />
            </mat-form-field>
        </div>  
    </form>
    <div>
        Expenses: {{ totalExpenses | currency: currencyService.getSelectedCurrency() }}
    </div>
    
    <div class="mb-6">
        Current Savings: {{ averageIncome - totalExpenses | currency: currencyService.getSelectedCurrency() }}
    </div>
      
    <!-- ACTION BUTTONS -->
    <div class="flex flex-row w-full justify-end gap-2 mb-4">        
        <button mat-button (click)="undo()" [disabled]="sliderHistory.length <= 1">
            <mat-icon fontSet="material-symbols-outlined">undo</mat-icon>
            <span>Undo</span>
        </button>
    
        <button mat-button (click)="toggleLockAllSliders()">
            <mat-icon fontSet="material-symbols-outlined">{{ allSlidersLocked ? 'lock_open' : 'lock' }}</mat-icon>
            <span>{{ allSlidersLocked ? 'Unlock All' : 'Lock All' }}</span>
        </button>
        
        <button mat-button (click)="autoFit = !autoFit" matTooltip="Bring the sliders both up and down so that current savings always close to target savings" [matTooltipShowDelay]="800">
            Always fit Target Savings: {{ autoFit ? 'On' : 'Off' }}
        </button>

        <button mat-button (click)="resetSliders()">
            <mat-icon [ngClass]="colorService.isDarkMode() ? 'negative-dark': 'negative-light'" fontSet="material-symbols-outlined">refresh</mat-icon>
            <span [ngClass]="colorService.isDarkMode() ? 'negative-dark': 'negative-light'">Reset Sliders</span>
        </button>
    </div>
    
    
    <!-- class="flex flex-row items-stretch justify-evenly overflow-auto" -->
    <div class="grid grid-cols-2 gap-x-10">
        @for (slider of sliders; track $index) {
            <!-- class="flex flex-col h-[400px] items-center justify-between slider-container" -->
            <div class="flex flex-col">
                <div class="flex flex-row items-center gap-2">
                    @if (slider.icon) {
                        <mat-icon fontSet="material-symbols-outlined" [ngStyle]="{ color: colorService.isDarkMode() ? slider.colorDark : slider.colorLight }">{{ slider.icon }}</mat-icon>
                    }
                    <h3>{{ slider.name }}</h3>
                </div>
                <div class="flex flex-row gap-2 items-center w-full">
                    <!-- style="width: 300px !important;display: flex !important; flex-direction: column; justify-content: center; transform: rotate(-90deg);" -->
                    <mat-slider
                        class="!w-[70%]"
                        [max]="slider.max"
                        discrete
                        [disabled]="slider.locked"
                        [displayWith]="formatBigNumbersFrom1K"
                    >   
                        <input matSliderStartThumb #sliderStart [value]="slider.min" (valueChange)="adjustMinValue(slider.name, sliderStart.value)">
                        <input matSliderEndThumb [value]="slider.value" (valueChange)="adjustSliders(slider.name, $event)">
                    </mat-slider>
                    <button mat-icon-button class="!flex" (click)="toggleLockSlider(slider.name)" [matTooltip]="slider.locked ? 'Unlock values to let them move again' : 'Lock value so it doesn\'t move'" [matTooltipShowDelay]="800">
                        <mat-icon fontSet="material-symbols-outlined">{{ slider.locked ? 'lock_open' : 'lock' }}</mat-icon>
                    </button>
                    <label>{{ formatBigNumbers(slider.value) }}</label>
                </div>
            </div>
        }
    </div>
</div>