<div class="py-4">
    <h2 class="text-2xl font-bold mb-4 text-center">Smart Budget Planner</h2>
    <div class="flex flex-col items-center">
        <div>
            <form [formGroup]="form">
                <div class="grid grid-cols-3 gap-x-2">
                    <mat-form-field>
                        <mat-label>Time frame</mat-label>
                        <mat-select [value]="calculationBasis" (valueChange)="onCalculationBasisChange($event)">
                            <mat-option value="monthly">1 Month</mat-option>
                            <mat-option value="yearly">1 Year</mat-option>
                        </mat-select>
                    </mat-form-field>
                    
                    <mat-form-field appearance="fill">
                      <mat-label>Target Savings</mat-label>
                      <input matInput type="number" formControlName="targetSavings" />
                    </mat-form-field>


                    <mat-form-field appearance="fill">
                      <mat-label>Average Income</mat-label>
                      <input matInput type="number" formControlName="averageIncome" />
                      <span matTextPrefix>{{ currencyService.getCurrencySymbol(currencyService.getSelectedCurrency()) }}&nbsp;</span>
                    </mat-form-field>
                </div>
            </form>
        </div>
    </div>    
      
    <mat-divider class="!my-10 w-full" [ngClass]="colorService.isDarkMode() ? '!border-gray-700' : '!border-gray-300'"></mat-divider>

    <div class="flex flex-row items-center justify-between  mb-6">
        <div class="flex flex-row items-center gap-2 w-full">
            <div class="py-3 px-6 rounded-2xl border-[2px] border-solid"
            [ngClass]="{
              '!border-neutral-500': colorService.isDarkMode() && (averageIncome - totalExpenses >= targetSurplus),
              '!border-neutral-400': !colorService.isDarkMode() && (averageIncome - totalExpenses >= targetSurplus),
              'border-red-400': colorService.isDarkMode() && (averageIncome - totalExpenses < targetSurplus),
              'border-red-700': !colorService.isDarkMode() && (averageIncome - totalExpenses < targetSurplus)
            }">
         Current Savings: {{ averageIncome - totalExpenses | currency: currencyService.getSelectedCurrency() }}
       </div>
        
            <div class="py-3 px-6 rounded-2xl border-[2px] border-solid" [ngClass]="colorService.isDarkMode() ? '!border-neutral-500' : '!border-neutral-400'">
                Target Savings: {{ targetSurplus | currency: currencyService.getSelectedCurrency() }}
            </div>
        </div>
        
        <!-- ACTION BUTTONS -->
        <div class="flex flex-row w-full justify-end gap-2 flex-wrap">        
            <button mat-button (click)="undo()" [disabled]="sliderHistory.length <= 1">
                <mat-icon fontSet="material-symbols-outlined">undo</mat-icon>
                <span>Undo</span>
            </button>
        
            <button mat-button (click)="toggleLockAllSliders()">
                <mat-icon fontSet="material-symbols-outlined">{{ allSlidersLocked ? 'lock_open' : 'lock' }}</mat-icon>
                <span>{{ allSlidersLocked ? 'Unlock All' : 'Lock All' }}</span>
            </button>
            
            <button mat-button (click)="autoFit = !autoFit" matTooltip="Bring the sliders both up and down so that current savings always close to target savings" [matTooltipShowDelay]="800">
                Always fit Target Savings: {{ autoFit ? 'On' : 'Off' }}
            </button>
    
            <button mat-button (click)="resetSliders()">
                <mat-icon [ngClass]="colorService.isDarkMode() ? 'negative-dark': 'negative-light'" fontSet="material-symbols-outlined">refresh</mat-icon>
                <span [ngClass]="colorService.isDarkMode() ? 'negative-dark': 'negative-light'">Reset Sliders</span>
            </button>
        </div>
    </div>
 
    <!-- SLIDERS -->
    <div class="grid grid-cols-2 gap-x-10 h-[70vh] overflow-auto">
        @for (slider of sliders; track $index) {
            <div class="flex flex-col">
                <div class="flex flex-row items-center gap-2">
                    @if (slider.icon) {
                        <mat-icon fontSet="material-symbols-outlined" [ngStyle]="{ color: colorService.isDarkMode() ? slider.colorDark : slider.colorLight }">{{ slider.icon }}</mat-icon>
                    }
                    <h3>{{ slider.name }}</h3>
                </div>
                <div class="flex flex-row gap-2 items-center w-full">
                    <mat-slider
                        class="!w-[50%]"
                        [max]="slider.max"
                        discrete
                        [disabled]="slider.locked"
                        [displayWith]="formatBigNumbersFrom1K"
                    >   
                        <input matSliderStartThumb #sliderStart [value]="slider.min" (valueChange)="adjustMinValue(slider.name, sliderStart.value)">
                        <input matSliderEndThumb [value]="slider.value" (valueChange)="adjustSliders(slider.name, $event)">
                    </mat-slider>
                    <button mat-icon-button class="!flex" (click)="toggleLockSlider(slider.name)" [matTooltip]="slider.locked ? 'Unlock values to let them move again' : 'Lock value so it doesn\'t move'" [matTooltipShowDelay]="800">
                        <mat-icon fontSet="material-symbols-outlined">{{ slider.locked ? 'lock_open' : 'lock' }}</mat-icon>
                    </button>
                    <!-- <label>{{ formatBigNumbers(slider.value) }}</label> -->
                    <mat-form-field appearance="outline" class="!w-40">
                        <!-- <mat-label>Set Value</mat-label> -->
                        <input 
                          matInput 
                          type="number" 
                          [(ngModel)]="slider.value"
                          [value]="slider.value"
                          (input)="adjustSliders(slider.name, slider.value)">
                        @if (calculationBasis == 'monthly') {
                            <mat-hint>{{ formatBigNumbersFrom1K(slider.value * 12) }} in year</mat-hint>
                        }
                    </mat-form-field>
                </div>
            </div>
        }
    </div>
    <mat-divider class="!my-10 w-full" [ngClass]="colorService.isDarkMode() ? '!border-gray-700' : '!border-gray-300'"></mat-divider>
    <!-- <div class="mt-4 text-center">
        Total Expenses: {{ totalExpenses | currency: currencyService.getSelectedCurrency() }}
    </div> -->
</div>